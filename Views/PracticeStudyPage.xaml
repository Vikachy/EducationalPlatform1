<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="EducationalPlatform.Views.PracticeStudyPage"
             Title="ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ">

    <Grid RowDefinitions="Auto,*,Auto">

        <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
        <Border Grid.Row="0" BackgroundColor="{DynamicResource PrimaryColor}" Padding="15">
            <HorizontalStackLayout>
                <Label x:Name="TitleLabel" 
                       Text="ÐŸÑ€Ð°ÐºÑ‚Ð¸ÐºÐ°" 
                       FontSize="20" 
                       TextColor="White" 
                       FontAttributes="Bold"
                       VerticalOptions="Center" />
                <Button Text="ÐÐ°Ð·Ð°Ð´" 
                        Clicked="OnBackClicked"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        Margin="20,0,0,0" />
            </HorizontalStackLayout>
        </Border>

        <!-- Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ñ -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="20" Spacing="15">

                <!-- ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ñ -->
                <Label x:Name="DescriptionLabel" 
                       FontSize="16"
                       LineBreakMode="WordWrap" />

                <!-- Ð¡Ñ‚Ð°Ñ€Ñ‚Ð¾Ð²Ñ‹Ð¹ ÐºÐ¾Ð´ -->
                <StackLayout x:Name="CodeSection" IsVisible="False">
                    <Label Text="Ð¡Ñ‚Ð°Ñ€Ñ‚Ð¾Ð²Ñ‹Ð¹ ÐºÐ¾Ð´:" 
                           FontSize="16" 
                           FontAttributes="Bold"
                           TextColor="{DynamicResource PrimaryColor}" />
                    <Editor x:Name="StarterCodeEditor" 
                            HeightRequest="150"
                            IsEnabled="False"
                            BackgroundColor="#F5F5F5" />
                    <Button Text="ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð´" 
                            Clicked="OnCopyCodeClicked"
                            BackgroundColor="{DynamicResource SecondaryColor}"
                            TextColor="White" />
                </StackLayout>

                <!-- ÐžÐ±Ð»Ð°ÑÑ‚ÑŒ Ð´Ð»Ñ Ð¾Ñ‚Ð²ÐµÑ‚Ð° -->
                <Label Text="Ð’Ð°Ñˆ Ð¾Ñ‚Ð²ÐµÑ‚:" 
                       FontSize="16" 
                       FontAttributes="Bold"
                       TextColor="{DynamicResource PrimaryColor}" />

                <!-- Ð¢ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ -->
                <StackLayout x:Name="TextAnswerSection">
                    <Editor x:Name="TextAnswerEditor" 
                            HeightRequest="120"
                            Placeholder="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°Ñˆ Ð¾Ñ‚Ð²ÐµÑ‚ Ð·Ð´ÐµÑÑŒ..." />
                </StackLayout>

                <!-- ÐžÑ‚Ð²ÐµÑ‚ ÐºÐ¾Ð´Ð¾Ð¼ -->
                <StackLayout x:Name="CodeAnswerSection" IsVisible="False">
                    <Editor x:Name="CodeAnswerEditor" 
                            HeightRequest="200"
                            Placeholder="ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð²Ð°Ñˆ ÐºÐ¾Ð´ Ð·Ð´ÐµÑÑŒ..."
                            FontFamily="Courier New" />
                    <Button Text="Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ ÐºÐ¾Ð´" 
                            Clicked="OnRunCodeClicked"
                            BackgroundColor="{DynamicResource AccentColor}"
                            TextColor="White" />
                </StackLayout>

                <!-- Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ„Ð°Ð¹Ð»Ð¾Ð² -->
                <StackLayout x:Name="FileAnswerSection" IsVisible="False">
                    <Button Text="Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»" 
                            Clicked="OnSelectFileClicked"
                            BackgroundColor="{DynamicResource PrimaryColor}"
                            TextColor="White" />
                    <Label x:Name="SelectedFileLabel" 
                           Text="Ð¤Ð°Ð¹Ð» Ð½Ðµ Ð²Ñ‹Ð±Ñ€Ð°Ð½"
                           FontSize="14"
                           TextColor="#666" />
                    <Label Text="ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñ‹: ZIP, JPG, PNG, PDF" 
                           FontSize="12"
                           TextColor="#999" />
                </StackLayout>

                <!-- ÐŸÐ¾Ð´ÑÐºÐ°Ð·ÐºÐ° -->
                <StackLayout x:Name="HintSection" IsVisible="False">
                    <Label Text="ÐŸÐ¾Ð´ÑÐºÐ°Ð·ÐºÐ°:" 
                           FontSize="14" 
                           FontAttributes="Bold"
                           TextColor="{DynamicResource SecondaryColor}" />
                    <Label x:Name="HintLabel" 
                           FontSize="14"
                           LineBreakMode="WordWrap" />
                </StackLayout>

                <!-- Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ -->
                <Border x:Name="ResultSection" 
                        IsVisible="False"
                        BackgroundColor="#E8F5E8"
                        Stroke="#4CAF50"
                        StrokeThickness="1"
                        Padding="15">
                    <VerticalStackLayout>
                        <Label x:Name="ResultLabel" 
                               Text="Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!"
                               FontSize="16"
                               TextColor="#4CAF50" />
                        <Label x:Name="FeedbackLabel" 
                               FontSize="14"
                               TextColor="#666" />
                    </VerticalStackLayout>
                </Border>

                <!-- ÐŸÑ€Ð¸ÐºÑ€ÐµÐ¿Ð»ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ -->
                <Border x:Name="AttachmentsSection" 
                        IsVisible="False"
                        BackgroundColor="#F8F9FA"
                        Padding="15"
                        Stroke="#DEE2E6"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 10"
                        Margin="0,15,0,0">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="ÐŸÑ€Ð¸ÐºÑ€ÐµÐ¿Ð»ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹:" 
                               FontSize="16" 
                               FontAttributes="Bold"
                               TextColor="{DynamicResource PrimaryColor}" />

                        <CollectionView x:Name="AttachmentsCollection" ItemsSource="{Binding Attachments}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <!-- Ð˜Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²Ð½Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ° Ñ„Ð°Ð¹Ð»Ð° -->
                                    <Border BackgroundColor="White"
                                            Stroke="{DynamicResource PrimaryColor}"
                                            StrokeThickness="2"
                                            StrokeShape="RoundRectangle 12"
                                            Padding="15"
                                            Margin="0,8">
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnAttachmentTapped" CommandParameter="{Binding .}" />
                                        </Border.GestureRecognizers>
                                        
                                        <Grid ColumnDefinitions="Auto,*,Auto" 
                                              ColumnSpacing="15"
                                              RowDefinitions="Auto,Auto">
                                            
                                            <!-- Ð‘Ð¾Ð»ÑŒÑˆÐ°Ñ Ð¸ÐºÐ¾Ð½ÐºÐ° Ñ„Ð°Ð¹Ð»Ð° -->
                                            <Border Grid.Row="0" Grid.RowSpan="2" Grid.Column="0"
                                                    BackgroundColor="{DynamicResource PrimaryColor}"
                                                    StrokeThickness="0"
                                                    StrokeShape="RoundRectangle 8"
                                                    WidthRequest="50"
                                                    HeightRequest="50"
                                                    VerticalOptions="Center">
                                                <Label Text="{Binding FileIcon}"
                                                       FontSize="24"
                                                       HorizontalOptions="Center"
                                                       VerticalOptions="Center"
                                                       TextColor="White"/>
                                            </Border>

                                            <!-- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ñ„Ð°Ð¹Ð»Ðµ -->
                                            <VerticalStackLayout Grid.Row="0" Grid.Column="1" Spacing="4">
                                                <Label Text="{Binding FileName}" 
                                                       FontSize="16"
                                                       FontAttributes="Bold"
                                                       LineBreakMode="TailTruncation"
                                                       TextColor="{DynamicResource TextColor}"/>
                                                <Label Text="{Binding FileSize}" 
                                                       FontSize="13"
                                                       TextColor="#666"/>
                                            </VerticalStackLayout>

                                            <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° ÑÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ñ -->
                                            <Button Grid.Row="0" Grid.RowSpan="2" Grid.Column="2"
                                                    Text="ðŸ“¥"
                                                    FontSize="20"
                                                    Clicked="OnOpenAttachmentClicked"
                                                    CommandParameter="{Binding .}"
                                                    BackgroundColor="{DynamicResource AccentColor}"
                                                    TextColor="White"
                                                    WidthRequest="50"
                                                    HeightRequest="50"
                                                    MinimumWidthRequest="50"
                                                    MinimumHeightRequest="50"
                                                    CornerRadius="25"
                                                    VerticalOptions="Center"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>

            </VerticalStackLayout>
        </ScrollView>

        <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ -->
        <Grid Grid.Row="2" ColumnDefinitions="*,*" ColumnSpacing="10" Padding="15">
            <Button Text="ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ" 
                    Clicked="OnCheckAnswerClicked"
                    BackgroundColor="{DynamicResource PrimaryColor}"
                    TextColor="White" />
            <Button Text="Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ âž¡ï¸" 
                    Clicked="OnNextClicked"
                    BackgroundColor="{DynamicResource SecondaryColor}"
                    TextColor="White" />
        </Grid>

    </Grid>
</ContentPage>