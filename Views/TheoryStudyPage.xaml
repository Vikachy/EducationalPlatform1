<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="EducationalPlatform.Views.TheoryStudyPage"
             Title="Ð˜Ð·ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ñ‚ÐµÐ¾Ñ€Ð¸Ð¸">

    <Grid RowDefinitions="Auto,*,Auto">

        <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
        <Border Grid.Row="0" BackgroundColor="{DynamicResource PrimaryColor}" Padding="15">
            <Grid ColumnDefinitions="*,Auto">
                <Label x:Name="TitleLabel" 
                       Text="Ð¢ÐµÐ¾Ñ€Ð¸Ñ" 
                       FontSize="20" 
                       TextColor="White" 
                       FontAttributes="Bold"
                       VerticalOptions="Center" />
                <Button Grid.Column="1"
                        Text="ÐÐ°Ð·Ð°Ð´" 
                        Clicked="OnBackClicked"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        Padding="20,0" />
            </Grid>
        </Border>

        <!-- Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ðµ Ñ‚ÐµÐ¾Ñ€Ð¸Ð¸ -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="20" Spacing="15">
                <Label x:Name="ContentLabel" 
                       FontSize="16"
                       LineBreakMode="WordWrap" />

                <!-- ÐŸÑ€Ð¸ÐºÑ€ÐµÐ¿Ð»ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ -->
                <Border x:Name="AttachmentsSection" 
                        IsVisible="False"
                        BackgroundColor="#F8F9FA"
                        Padding="15"
                        Stroke="#DEE2E6"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 10">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="ÐŸÑ€Ð¸ÐºÑ€ÐµÐ¿Ð»ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹:" 
                               FontSize="16" 
                               FontAttributes="Bold"
                               TextColor="{DynamicResource PrimaryColor}" />

                        <CollectionView x:Name="AttachmentsCollection">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <!-- Ð˜Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²Ð½Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ° Ñ„Ð°Ð¹Ð»Ð° -->
                                    <Border BackgroundColor="White"
                                            Stroke="{DynamicResource PrimaryColor}"
                                            StrokeThickness="2"
                                            StrokeShape="RoundRectangle 12"
                                            Padding="15"
                                            Margin="0,8">
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnAttachmentTapped" CommandParameter="{Binding .}" />
                                        </Border.GestureRecognizers>
                                        
                                        <Grid ColumnDefinitions="Auto,*,Auto" 
                                              ColumnSpacing="15"
                                              RowDefinitions="Auto,Auto">
                                            
                                            <!-- Ð‘Ð¾Ð»ÑŒÑˆÐ°Ñ Ð¸ÐºÐ¾Ð½ÐºÐ° Ñ„Ð°Ð¹Ð»Ð° -->
                                            <Border Grid.Row="0" Grid.RowSpan="2" Grid.Column="0"
                                                    BackgroundColor="{DynamicResource PrimaryColor}"
                                                    StrokeThickness="0"
                                                    StrokeShape="RoundRectangle 8"
                                                    WidthRequest="50"
                                                    HeightRequest="50"
                                                    VerticalOptions="Center">
                                                <Label Text="{Binding FileIcon}"
                                                       FontSize="24"
                                                       HorizontalOptions="Center"
                                                       VerticalOptions="Center"
                                                       TextColor="White"/>
                                            </Border>

                                            <!-- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ñ„Ð°Ð¹Ð»Ðµ -->
                                            <VerticalStackLayout Grid.Row="0" Grid.Column="1" Spacing="4">
                                                <Label Text="{Binding FileName}" 
                                                       FontSize="16"
                                                       FontAttributes="Bold"
                                                       LineBreakMode="TailTruncation"
                                                       TextColor="{DynamicResource TextColor}"/>
                                                <Label Text="{Binding FileSize}" 
                                                       FontSize="13"
                                                       TextColor="#666"/>
                                            </VerticalStackLayout>

                                            <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° ÑÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ñ -->
                                            <Button Grid.Row="0" Grid.RowSpan="2" Grid.Column="2"
                                                    Text="ðŸ“¥"
                                                    FontSize="20"
                                                    Clicked="OnOpenAttachmentClicked"
                                                    CommandParameter="{Binding .}"
                                                    BackgroundColor="{DynamicResource AccentColor}"
                                                    TextColor="White"
                                                    WidthRequest="50"
                                                    HeightRequest="50"
                                                    MinimumWidthRequest="50"
                                                    MinimumHeightRequest="50"
                                                    CornerRadius="25"
                                                    VerticalOptions="Center"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>
        </ScrollView>

        <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð½Ð°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ð¸ -->
        <Grid Grid.Row="2" ColumnDefinitions="*,*" ColumnSpacing="10" Padding="15">
            <Button x:Name="PrevButton" 
                    Text="â¬…ï¸ ÐŸÑ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ð¹" 
                    Clicked="OnPrevClicked"
                    IsVisible="False"
                    Style="{DynamicResource StandardButtonStyle}"
                    BackgroundColor="#6C757D"/>
            <Button x:Name="NextButton" 
                    Text="Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ âž¡ï¸" 
                    Clicked="OnNextClicked"
                    Style="{DynamicResource StandardButtonStyle}"
                    BackgroundColor="{DynamicResource PrimaryColor}"/>
        </Grid>

    </Grid>
</ContentPage>