<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="EducationalPlatform.Views.MainDashboardPage"
    Title="Главная">

    <Grid RowDefinitions="Auto,*">
        <!-- ШАПКА С АНИМАЦИЕЙ -->
        <Border Grid.Row="0"
                BackgroundColor="{DynamicResource PrimaryColor}"
                Stroke="{DynamicResource SecondaryColor}"
                StrokeThickness="1"
                StrokeShape="RoundRectangle 0,0,0,20"
                Padding="0">
            <Grid ColumnDefinitions="Auto,*,Auto,Auto"
                  Padding="20,15"
                  VerticalOptions="Center">

                <!-- АВАТАР -->
                <Border Grid.Column="0"
                        BackgroundColor="White"
                        Stroke="{DynamicResource AccentColor}"
                        StrokeThickness="2"
                        StrokeShape="RoundRectangle 25"
                        WidthRequest="50"
                        HeightRequest="50"
                        VerticalOptions="Center">
                    <Label Text="👨‍💻"
                           FontSize="20"
                           HorizontalOptions="Center"
                           VerticalOptions="Center" />
                </Border>

                <!-- ПРИВЕТСТВИЕ -->
                <VerticalStackLayout Grid.Column="1"
                                    Spacing="2"
                                    Padding="15,0"
                                    VerticalOptions="Center">
                    <Label x:Name="WelcomeLabel"
                           Text="Добро пожаловать!"
                           FontSize="16"
                           TextColor="White"
                           FontAttributes="Bold" />
                    <Label x:Name="StatsLabel"
                           Text="Серия: 0 дней 🔥 | Валюта: 0 🪙"
                           FontSize="12"
                           TextColor="White" />
                </VerticalStackLayout>

                <!-- КНОПКА НАСТРОЕК -->
                <Button Grid.Column="2"
                        Text="⚙️"
                        Clicked="OnSettingsClicked"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        FontSize="18"
                        WidthRequest="45"
                        HeightRequest="45"
                        CornerRadius="22"
                        Margin="0,0,10,0" />

                <!-- КНОПКА ПРОФИЛЯ -->
                <Button Grid.Column="3"
                        Text="👤"
                        Clicked="OnProfileClicked"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        FontSize="20"
                        WidthRequest="45"
                        HeightRequest="45"
                        CornerRadius="22" />
            </Grid>
        </Border>

        <!-- ОСНОВНОЙ КОНТЕНТ (без изменений из предыдущей версии) -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="20" Padding="20">

                <!-- БЛОК С СЕРИЕЙ И ГИФКОЙ ОГНЯ -->
                <Border BackgroundColor="Black"
                        Stroke="{DynamicResource AccentColor}"
                        StrokeThickness="2"
                        StrokeShape="RoundRectangle 15"
                        HeightRequest="120"
                        HorizontalOptions="Fill">
                    <Grid>
                        <VerticalStackLayout
                            HorizontalOptions="Center"
                            VerticalOptions="Center"
                            Spacing="10">
                            <Label Text="🔥 Огонек 🔥"
                                   FontSize="20"
                                   TextColor="White"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center" />

                            <!-- СЕРИЯ С ГИФКОЙ ОГНЯ -->
                            <HorizontalStackLayout Spacing="10"
                                                  HorizontalOptions="Center"
                                                  VerticalOptions="Center">
                                <Image
                                    x:Name="FireGif"
                                    Source="fire_animation.gif"
                                    HeightRequest="40"
                                    WidthRequest="40"
                                    HorizontalOptions="Center"
                                    VerticalOptions="Center" />

                                <Label x:Name="StreakFireLabel"
                                       Text="Серия: 0 дней"
                                       FontSize="16"
                                       TextColor="White"
                                       FontAttributes="Bold"
                                       VerticalOptions="Center" />
                            </HorizontalStackLayout>

                            <Button Text="🔥 Продолжить серию"
                                    Clicked="OnContinueStreakClicked"
                                    BackgroundColor="{DynamicResource AccentColor}"
                                    TextColor="White"
                                    HeightRequest="30"
                                    CornerRadius="15"
                                    FontSize="12"
                                    HorizontalOptions="Center" />
                        </VerticalStackLayout>
                    </Grid>
                </Border>

                <!-- МОИ АКТИВНЫЕ КУРСЫ -->
                <Border BackgroundColor="{DynamicResource BackgroundColor}"
                        Stroke="{DynamicResource PrimaryColor}"
                        StrokeThickness="2"
                        StrokeShape="RoundRectangle 15"
                        Padding="0">
                    <VerticalStackLayout Spacing="0">
                        <Border BackgroundColor="{DynamicResource PrimaryColor}"
                                StrokeThickness="0"
                                Padding="20,15">
                            <HorizontalStackLayout>
                                <Label Text="🎯 Мои активные курсы"
                                       FontSize="18"
                                       TextColor="White"
                                       FontAttributes="Bold"
                                       VerticalOptions="Center" />
                                <Button Text="Все курсы →"
                                        Clicked="OnAllCoursesClicked"
                                        BackgroundColor="Transparent"
                                        TextColor="White"
                                        BorderColor="White"
                                        BorderWidth="1"
                                        HeightRequest="35"
                                        CornerRadius="15"
                                        Margin="20,0,0,0" />
                            </HorizontalStackLayout>
                        </Border>

                        <CollectionView x:Name="MyCoursesCollectionView"
                                      HeightRequest="180"
                                      SelectionMode="Single"
                                      SelectionChanged="OnMyCourseSelected">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border Margin="15,10"
                                            BackgroundColor="#F8F9FA"
                                            Stroke="{DynamicResource PrimaryColor}"
                                            StrokeThickness="1"
                                            StrokeShape="RoundRectangle 10"
                                            Padding="15">
                                        <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto" 
                                              RowSpacing="5" ColumnSpacing="10">
                                            <Label Grid.Row="0" Grid.Column="0"
                                                   Text="{Binding CourseName}"
                                                   FontSize="16"
                                                   FontAttributes="Bold"
                                                   TextColor="{DynamicResource TextColor}" />
                                            <Label Grid.Row="0" Grid.Column="1"
                                                   Text="{Binding Progress, StringFormat='{0}%'}"
                                                   FontSize="14"
                                                   TextColor="{DynamicResource PrimaryColor}"
                                                   FontAttributes="Bold" />

                                            <ProgressBar Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                                         Progress="{Binding ProgressDecimal}"
                                                         ProgressColor="{DynamicResource PrimaryColor}"
                                                         BackgroundColor="#E0E0E0"
                                                         HeightRequest="8"
                                                         VerticalOptions="Center" />

                                            <HorizontalStackLayout Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                                                  Spacing="10">
                                                <Label Text="{Binding Language}"
                                                       FontSize="10"
                                                       BackgroundColor="{DynamicResource SecondaryColor}"
                                                       TextColor="White"
                                                       Padding="5,2" />
                                                <Label Text="{Binding Difficulty}"
                                                       FontSize="10"
                                                       BackgroundColor="{DynamicResource AccentColor}"
                                                       TextColor="White"
                                                       Padding="5,2" />
                                                <Label Text="{Binding TimeLeft}"
                                                       FontSize="10"
                                                       BackgroundColor="#666"
                                                       TextColor="White"
                                                       Padding="5,2" />
                                            </HorizontalStackLayout>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>

                <Label Text="🚀 Быстрый доступ"
                       FontSize="20"
                       TextColor="{DynamicResource TextColor}"
                       FontAttributes="Bold" />

                <Grid ColumnDefinitions="*,*"
                      ColumnSpacing="15"
                      RowSpacing="15">

                    <!-- КУРСЫ -->
                    <Border Grid.Row="0" Grid.Column="0"
                            BackgroundColor="{DynamicResource BackgroundColor}"
                            Stroke="{DynamicResource PrimaryColor}"
                            StrokeThickness="2"
                            StrokeShape="RoundRectangle 15">
                        <VerticalStackLayout Spacing="12" Padding="20">
                            <Label Text="📚"
                                   FontSize="28"
                                   HorizontalOptions="Center" />
                            <Label Text="Все курсы"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   TextColor="{DynamicResource TextColor}" />
                            <Button Text="Изучать →"
                                    Clicked="OnCoursesClicked"
                                    BackgroundColor="{DynamicResource PrimaryColor}"
                                    TextColor="White"
                                    HeightRequest="40"
                                    CornerRadius="20"
                                    FontAttributes="Bold" />
                        </VerticalStackLayout>
                    </Border>

                    <!-- ПРОГРЕСС -->
                    <Border Grid.Row="0" Grid.Column="1"
                            BackgroundColor="{DynamicResource BackgroundColor}"
                            Stroke="{DynamicResource PrimaryColor}"
                            StrokeThickness="2"
                            StrokeShape="RoundRectangle 15">
                        <VerticalStackLayout Spacing="12" Padding="20">
                            <Label Text="📊"
                                   FontSize="28"
                                   HorizontalOptions="Center" />
                            <Label Text="Прогресс"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   TextColor="{DynamicResource TextColor}" />
                            <Button Text="Смотреть →"
                                    Clicked="OnProgressClicked"
                                    BackgroundColor="{DynamicResource PrimaryColor}"
                                    TextColor="White"
                                    HeightRequest="40"
                                    CornerRadius="20"
                                    FontAttributes="Bold" />
                        </VerticalStackLayout>
                    </Border>

                    <!-- ДОСТИЖЕНИЯ -->
                    <Border Grid.Row="1" Grid.Column="0"
                            BackgroundColor="{DynamicResource BackgroundColor}"
                            Stroke="{DynamicResource AccentColor}"
                            StrokeThickness="2"
                            StrokeShape="RoundRectangle 15">
                        <VerticalStackLayout Spacing="12" Padding="20">
                            <Label Text="🏆"
                                   FontSize="28"
                                   HorizontalOptions="Center" />
                            <Label Text="Достижения"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   TextColor="{DynamicResource TextColor}" />
                            <Button Text="Мои награды →"
                                    Clicked="OnAchievementsClicked"
                                    BackgroundColor="{DynamicResource AccentColor}"
                                    TextColor="White"
                                    HeightRequest="40"
                                    CornerRadius="20"
                                    FontAttributes="Bold" />
                        </VerticalStackLayout>
                    </Border>

                    <!-- МАГАЗИН -->
                    <Border Grid.Row="1" Grid.Column="1"
                            BackgroundColor="{DynamicResource BackgroundColor}"
                            Stroke="{DynamicResource SecondaryColor}"
                            StrokeThickness="2"
                            StrokeShape="RoundRectangle 15">
                        <VerticalStackLayout Spacing="12" Padding="20">
                            <Label Text="🛒"
                                   FontSize="28"
                                   HorizontalOptions="Center" />
                            <Label Text="Магазин"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   TextColor="{DynamicResource TextColor}" />
                            <Button Text="Покупать →"
                                    Clicked="OnShopClicked"
                                    BackgroundColor="{DynamicResource SecondaryColor}"
                                    TextColor="White"
                                    HeightRequest="40"
                                    CornerRadius="20"
                                    FontAttributes="Bold" />
                        </VerticalStackLayout>
                    </Border>
                </Grid>

                <!-- СЕГОДНЯШНИЕ ЗАДАЧИ -->
                <Border BackgroundColor="{DynamicResource BackgroundColor}"
                        Stroke="#4CAF50"
                        StrokeThickness="2"
                        StrokeShape="RoundRectangle 15"
                        Padding="0">
                    <VerticalStackLayout Spacing="0">
                        <Border BackgroundColor="#4CAF50"
                                StrokeThickness="0"
                                Padding="20,15">
                            <HorizontalStackLayout>
                                <Label Text="✅ Сегодняшние задачи"
                                       FontSize="18"
                                       TextColor="White"
                                       FontAttributes="Bold"
                                       VerticalOptions="Center" />
                                <Label x:Name="TodayTasksCountLabel"
                                       Text="2/5 завершено"
                                       FontSize="14"
                                       TextColor="White"
                                       Margin="20,0,0,0"
                                       VerticalOptions="Center" />
                            </HorizontalStackLayout>
                        </Border>

                        <CollectionView x:Name="TodayTasksCollectionView"
                                      HeightRequest="150"
                                      SelectionMode="None">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border Margin="15,8"
                                            BackgroundColor="{Binding CardColor}"
                                            Stroke="{Binding BorderColor}"
                                            StrokeThickness="1"
                                            StrokeShape="RoundRectangle 8"
                                            Padding="12">
                                        <Grid ColumnDefinitions="Auto,*,Auto" VerticalOptions="Center">
                                            <Label Grid.Column="0"
                                                   Text="{Binding Icon}"
                                                   FontSize="16"
                                                   VerticalOptions="Center" />
                                            <VerticalStackLayout Grid.Column="1" Spacing="2" Margin="10,0">
                                                <Label Text="{Binding Title}"
                                                       FontSize="14"
                                                       FontAttributes="Bold"
                                                       TextColor="{DynamicResource TextColor}" />
                                                <Label Text="{Binding Description}"
                                                       FontSize="11"
                                                       TextColor="#666" />
                                            </VerticalStackLayout>
                                            <Button Grid.Column="2"
                                                    Text="{Binding ButtonText}"
                                                    Clicked="OnTaskButtonClicked"
                                                    BackgroundColor="{Binding ButtonColor}"
                                                    TextColor="White"
                                                    HeightRequest="30"
                                                    CornerRadius="15"
                                                    FontSize="10"
                                                    CommandParameter="{Binding .}" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>
                <!-- ПАНЕЛЬ УЧИТЕЛЯ (ТОЛЬКО ДЛЯ УЧИТЕЛЕЙ) -->
                <!-- ПАНЕЛЬ УЧИТЕЛЯ (ТОЛЬКО ДЛЯ УЧИТЕЛЕЙ) -->
                <Border x:Name="TeacherPanel"
        BackgroundColor="{DynamicResource BackgroundColor}"
        Stroke="{DynamicResource AccentColor}"
        StrokeThickness="2"
        StrokeShape="RoundRectangle 15"
        IsVisible="False"
        Padding="20">
                    <VerticalStackLayout Spacing="15">
                        <Label Text="👨‍🏫 Панель преподавателя"
               FontSize="18"
               FontAttributes="Bold"
               TextColor="{DynamicResource AccentColor}"
               HorizontalOptions="Center" />
                        <Button Text="Управление курсами"
                Clicked="OnTeacherManagementClicked"
                BackgroundColor="{DynamicResource AccentColor}"
                TextColor="White"
                HeightRequest="40"
                CornerRadius="20" />
                    </VerticalStackLayout>
                </Border>
                <!-- ЛЕНТА НОВОСТЕЙ -->
                <Border BackgroundColor="{DynamicResource BackgroundColor}"
                        Stroke="{DynamicResource PrimaryColor}"
                        StrokeThickness="2"
                        StrokeShape="RoundRectangle 15"
                        Padding="0">
                    <VerticalStackLayout Spacing="0">
                        <Border BackgroundColor="{DynamicResource PrimaryColor}"
                                StrokeThickness="0"
                                Padding="20,15">
                            <HorizontalStackLayout>
                                <Label Text="📢 Последние новости"
                                       FontSize="18"
                                       TextColor="White"
                                       FontAttributes="Bold"
                                       VerticalOptions="Center" />
                                <Button Text="Все новости →"
                                        Clicked="OnAllNewsClicked"
                                        BackgroundColor="Transparent"
                                        TextColor="White"
                                        BorderColor="White"
                                        BorderWidth="1"
                                        HeightRequest="35"
                                        CornerRadius="15"
                                        Margin="20,0,0,0" />
                            </HorizontalStackLayout>
                        </Border>
                        <CollectionView x:Name="NewsCollectionView"
                                      HeightRequest="200"
                                      SelectionMode="None">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border Margin="15,10"
                                            BackgroundColor="#F8F9FA"
                                            Stroke="#E0E0E0"
                                            StrokeThickness="1"
                                            StrokeShape="RoundRectangle 10"
                                            Padding="15">
                                        <VerticalStackLayout Spacing="8">
                                            <Label Text="{Binding Title}"
                                                   FontSize="16"
                                                   FontAttributes="Bold"
                                                   TextColor="{DynamicResource TextColor}" />
                                            <Label Text="{Binding Content}"
                                                   FontSize="13"
                                                   TextColor="#666"
                                                   MaxLines="2" />
                                            <Label Text="{Binding PublishedDate, StringFormat='📅 {0:dd.MM.yyyy}'}"
                                                   FontSize="11"
                                                   TextColor="#999" />
                                        </VerticalStackLayout>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>