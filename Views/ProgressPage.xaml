<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:EducationalPlatform.Converters"
    x:Class="EducationalPlatform.Views.ProgressPage"
    Title="Progress">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:PercentConverter x:Key="PercentConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <Grid>
            <!-- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ -->
            <VerticalStackLayout 
                x:Name="LoadingIndicator"
                IsVisible="False"
                VerticalOptions="Center"
                HorizontalOptions="Center"
                Spacing="20">
                <ActivityIndicator
                    IsRunning="True"
                    Color="{DynamicResource PrimaryColor}"
                    HeightRequest="50"
                    WidthRequest="50"/>
                <Label 
                    Text="Loading data..."
                    TextColor="{DynamicResource TextColor}"
                    HorizontalOptions="Center"/>
            </VerticalStackLayout>

            <!-- ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ -->
            <VerticalStackLayout 
                x:Name="MainContent"
                Spacing="20" 
                Padding="20">

                <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
                <Label x:Name="TitleLabel" 
                       Text="ðŸ“Š Learning Progress"
                       FontSize="28"
                       TextColor="{DynamicResource TextColor}"
                       FontAttributes="Bold"
                       HorizontalOptions="Center" />

                <!-- ÐžÐ±Ñ‰Ð°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° -->
                <Border Style="{DynamicResource StandardFrameStyle}" Padding="15">
                    <VerticalStackLayout Spacing="15">
                        <Label x:Name="OverallProgressLabel"
                               Text="Overall Progress"
                               FontSize="18"
                               TextColor="{DynamicResource TextColor}"
                               FontAttributes="Bold" />

                        <Grid ColumnDefinitions="*, *" RowDefinitions="*, *" ColumnSpacing="15" RowSpacing="15">

                            <!-- Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð½Ñ‹Ðµ ÐºÑƒÑ€ÑÑ‹ -->
                            <VerticalStackLayout Grid.Row="0" Grid.Column="0" Spacing="8">
                                <Label x:Name="CompletedCoursesText"
                                       Text="Completed Courses"
                                       TextColor="{DynamicResource TextColor}"
                                       FontSize="14"/>
                                <ProgressBar 
                                    Progress="{Binding UserStatistics.CompletedCourses, Converter={StaticResource PercentConverter}}"
                                    ProgressColor="{DynamicResource PrimaryColor}"
                                    BackgroundColor="#E0E0E0"
                                    HeightRequest="8"/>
                                <Label 
                                    Text="{Binding UserStatistics.CompletedCourses, StringFormat='{0} completed'}"
                                    TextColor="{DynamicResource TextColor}"
                                    FontSize="12"
                                    HorizontalOptions="Center"/>
                            </VerticalStackLayout>

                            <!-- Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ð±Ð°Ð»Ð» -->
                            <VerticalStackLayout Grid.Row="0" Grid.Column="1" Spacing="8">
                                <Label x:Name="AverageScoreText"
                                       Text="Average Score"
                                       TextColor="{DynamicResource TextColor}"
                                       FontSize="14"/>
                                <ProgressBar 
                                    Progress="{Binding UserStatistics.AverageScore, Converter={StaticResource PercentConverter}}"
                                    ProgressColor="{DynamicResource AccentColor}"
                                    BackgroundColor="#E0E0E0"
                                    HeightRequest="8"/>
                                <Label 
                                    Text="{Binding UserStatistics.AverageScore, StringFormat='{0:F1}%'}"
                                    TextColor="{DynamicResource TextColor}"
                                    FontSize="12"
                                    HorizontalOptions="Center"/>
                            </VerticalStackLayout>

                            <!-- ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ -->
                            <VerticalStackLayout Grid.Row="1" Grid.Column="0" Spacing="8">
                                <Label x:Name="CompletionRateText"
                                       Text="Completion Rate"
                                       TextColor="{DynamicResource TextColor}"
                                       FontSize="14"/>
                                <ProgressBar 
                                    Progress="{Binding UserStatistics.CompletionRate}"
                                    ProgressColor="{DynamicResource SecondaryColor}"
                                    BackgroundColor="#E0E0E0"
                                    HeightRequest="8"/>
                                <Label 
                                    Text="{Binding UserStatistics.CompletionRate, StringFormat='{0:P1}'}"
                                    TextColor="{DynamicResource TextColor}"
                                    FontSize="12"
                                    HorizontalOptions="Center"/>
                            </VerticalStackLayout>

                            <!-- Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° -->
                            <VerticalStackLayout Grid.Row="1" Grid.Column="1" Spacing="10">
                                <Grid ColumnDefinitions="*, *" ColumnSpacing="10" RowSpacing="10">
                                    <VerticalStackLayout Spacing="4">
                                        <Label x:Name="CurrentStreakText"
                                               Text="Current Streak"
                                               TextColor="{DynamicResource TextColor}"
                                               FontSize="11"
                                               HorizontalOptions="Center"/>
                                        <Label 
                                            Text="{Binding UserStatistics.CurrentStreak, StringFormat='{0} days'}"
                                            TextColor="{DynamicResource PrimaryColor}"
                                            FontSize="16"
                                            FontAttributes="Bold"
                                            HorizontalOptions="Center"/>
                                    </VerticalStackLayout>

                                    <VerticalStackLayout Grid.Column="1" Spacing="4">
                                        <Label x:Name="TotalLearningText"
                                               Text="Total Days"
                                               TextColor="{DynamicResource TextColor}"
                                               FontSize="11"
                                               HorizontalOptions="Center"/>
                                        <Label 
                                            Text="{Binding UserStatistics.TotalDays, StringFormat='{0} days'}"
                                            TextColor="{DynamicResource SecondaryColor}"
                                            FontSize="16"
                                            FontAttributes="Bold"
                                            HorizontalOptions="Center"/>
                                    </VerticalStackLayout>
                                </Grid>
                            </VerticalStackLayout>

                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!-- ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ -->
                <Border Style="{DynamicResource StandardFrameStyle}" Padding="15">
                    <VerticalStackLayout Spacing="15">
                        <Label x:Name="RecentAchievementsLabel"
                               Text="Recent Achievements"
                               FontSize="18"
                               TextColor="{DynamicResource TextColor}"
                               FontAttributes="Bold" />

                        <CollectionView x:Name="AchievementsCollectionView"
                                      ItemsSource="{Binding RecentAchievements}"
                                      SelectionMode="Single"
                                      SelectionChanged="OnAchievementSelected"
                                      ItemsLayout="VerticalList"
                                      HeightRequest="200">
                            <CollectionView.EmptyView>
                                <Label x:Name="NoAchievementsLabel"
                                       Text="No achievements yet"
                                       TextColor="#666"
                                       FontSize="14"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"/>
                            </CollectionView.EmptyView>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="10" ColumnDefinitions="Auto, *" RowDefinitions="Auto, Auto">
                                        <Label Grid.Row="0" Grid.Column="0" Grid.RowSpan="2"
                                               Text="{Binding Icon}"
                                               FontSize="24"
                                               VerticalOptions="Center"
                                               Margin="0,0,10,0"/>
                                        <Label Grid.Row="0" Grid.Column="1"
                                               Text="{Binding Name}"
                                               TextColor="{DynamicResource TextColor}"
                                               FontSize="14"
                                               FontAttributes="Bold"/>
                                        <Label Grid.Row="1" Grid.Column="1"
                                               Text="{Binding Description}"
                                               TextColor="{DynamicResource TextColor}"
                                               FontSize="12"/>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>

                <!-- ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ Ð¿Ð¾ ÐºÑƒÑ€ÑÐ°Ð¼ -->
                <Border Style="{DynamicResource StandardFrameStyle}" Padding="15">
                    <VerticalStackLayout Spacing="15">
                        <Label x:Name="CourseProgressLabel"
                               Text="Course Progress"
                               FontSize="18"
                               TextColor="{DynamicResource TextColor}"
                               FontAttributes="Bold" />

                        <CollectionView x:Name="CourseProgressCollectionView"
                                      ItemsSource="{Binding ProgressItems}"
                                      SelectionMode="Single"
                                      SelectionChanged="OnCourseSelected"
                                      ItemsLayout="VerticalList">
                            <CollectionView.EmptyView>
                                <Label x:Name="NoCoursesLabel"
                                       Text="No courses found"
                                       TextColor="#666"
                                       FontSize="14"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"/>
                            </CollectionView.EmptyView>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border Padding="15" 
                                          Stroke="{Binding StatusColor}"
                                          StrokeThickness="2"
                                          StrokeShape="RoundRectangle 10"
                                          Margin="0,5">
                                        <VerticalStackLayout Spacing="8">
                                            <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð¸ ÑÑ‚Ð°Ñ‚ÑƒÑ -->
                                            <Grid>
                                                <Label Text="{Binding CourseName}"
                                                       TextColor="{DynamicResource TextColor}"
                                                       FontSize="16"
                                                       FontAttributes="Bold"
                                                       LineBreakMode="TailTruncation"/>
                                                <Label Text="{Binding StatusText}"
                                                       TextColor="{Binding StatusColor}"
                                                       FontSize="12"
                                                       FontAttributes="Bold"
                                                       HorizontalOptions="End"/>
                                            </Grid>

                                            <!-- ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ-Ð±Ð°Ñ€ -->
                                            <Grid ColumnDefinitions="*, Auto">
                                                <ProgressBar 
                                                    Progress="{Binding Score, Converter={StaticResource PercentConverter}}"
                                                    ProgressColor="{Binding StatusColor}"
                                                    BackgroundColor="#E0E0E0"
                                                    HeightRequest="8"
                                                    VerticalOptions="Center"/>
                                                <Label Grid.Column="1"
                                                       Text="{Binding Score, StringFormat='{0}%'}"
                                                       TextColor="{DynamicResource TextColor}"
                                                       FontSize="12"
                                                       Margin="10,0,0,0"/>
                                            </Grid>

                                            <!-- Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ -->
                                            <Grid ColumnDefinitions="*, *">
                                                <Label Text="{Binding Attempts, StringFormat='Attempts: {0}'}"
                                                       TextColor="#666"
                                                       FontSize="11"/>
                                                <Label Grid.Column="1"
                                                       Text="{Binding FormattedCompletionDate}"
                                                       TextColor="#666"
                                                       FontSize="11"
                                                       HorizontalOptions="End"/>
                                            </Grid>
                                        </VerticalStackLayout>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð° -->
                <Button Text="Back to Home"
                        Clicked="OnBackClicked"
                        Style="{DynamicResource StandardButtonStyle}"
                        HorizontalOptions="Center" />

            </VerticalStackLayout>
        </Grid>
    </ScrollView>

</ContentPage>