<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="EducationalPlatform.Views.ChatPage"
    Title="Ð“Ñ€ÑƒÐ¿Ð¿Ð¾Ð²Ð¾Ð¹ Ñ‡Ð°Ñ‚"
    BackgroundColor="{DynamicResource BackgroundColor}">

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ñ‡Ð°Ñ‚Ð° -->
        <Border Grid.Row="0" 
                BackgroundColor="#2E86AB" 
                Padding="15">
            <VerticalStackLayout>
                <Label Text="{Binding GroupName}"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="White"
                       HorizontalOptions="Center" />

                <Label Text="{Binding OnlineCount, StringFormat='ÐžÐ½Ð»Ð°Ð¹Ð½: {0}'}"
                       FontSize="12"
                       TextColor="White"
                       HorizontalOptions="Center" />
            </VerticalStackLayout>
        </Border>

        <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ -->
        <CollectionView Grid.Row="1"
                        x:Name="MessagesCollectionView"
                        ItemsSource="{Binding Messages}"
                        SelectionMode="None">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border Padding="10"
                            Margin="5"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 15">

                        <VerticalStackLayout Spacing="5">
                            <!-- Ð˜Ð¼Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÐµÐ»Ñ Ð¸ Ð²Ñ€ÐµÐ¼Ñ -->
                            <Grid ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0"
                                       Text="{Binding SenderName}"
                                       FontSize="12"
                                       FontAttributes="Bold"
                                       TextColor="{Binding IsMyMessage, Converter={StaticResource BoolToColorConverter}}" />

                                <Label Grid.Column="1"
                                       Text="{Binding SentDate, StringFormat='{0:HH:mm}'}"
                                       FontSize="10"
                                       TextColor="{Binding IsMyMessage, Converter={StaticResource BoolToTimeColorConverter}}" />
                            </Grid>

                            <!-- Ð¢ÐµÐºÑÑ‚ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ -->
                            <Label Text="{Binding MessageText}"
                                   FontSize="14"
                                   TextColor="{Binding IsMyMessage, Converter={StaticResource BoolToTextColorConverter}}"
                                   LineBreakMode="WordWrap" />

                            <!-- Ð¤Ð°Ð¹Ð»Ð¾Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ -->
                            <Grid ColumnDefinitions="Auto,*" 
                                  ColumnSpacing="8"
                                  IsVisible="{Binding IsFileMessage}">
                                <Label Grid.Column="0"
                                       Text="{Binding FileType, Converter={StaticResource FileTypeToIconConverter}}"
                                       FontSize="16"
                                       VerticalOptions="Center" />
                                <VerticalStackLayout Grid.Column="1">
                                    <Label Text="{Binding FileName}"
                                           FontSize="13"
                                           FontAttributes="Bold"
                                           LineBreakMode="TailTruncation" />
                                    <Label Text="{Binding FileSize}"
                                           FontSize="11"
                                           TextColor="Gray" />
                                </VerticalStackLayout>
                            </Grid>

                            <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð¿Ñ€Ð¾Ñ‡Ñ‚ÐµÐ½Ð¸Ñ -->
                            <Label Text="ÐŸÑ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ð½Ð¾"
                                   FontSize="10"
                                   TextColor="{Binding IsMyMessage, Converter={StaticResource BoolToTimeColorConverter}}"
                                   HorizontalOptions="End"
                                   IsVisible="{Binding IsMyMessage}" />
                        </VerticalStackLayout>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- ÐŸÐ¾Ð»Ðµ Ð²Ð²Ð¾Ð´Ð° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ -->
        <Border Grid.Row="2"
                BackgroundColor="White"
                Stroke="#E0E0E0"
                StrokeThickness="1"
                Padding="10">
            <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10">
                <!-- ÐŸÐ¾Ð»Ðµ Ð²Ð²Ð¾Ð´Ð° -->
                <Entry Grid.Column="0"
                       x:Name="MessageEntry"
                       Placeholder="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ..."
                       Completed="OnMessageSent"
                       ReturnType="Send" />

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¿Ñ€Ð¸ÐºÑ€ÐµÐ¿Ð»ÐµÐ½Ð¸Ñ Ñ„Ð°Ð¹Ð»Ð° -->
                <Button Grid.Column="1"
                        Text="ðŸ“Ž"
                        BackgroundColor="Transparent"
                        TextColor="#2E86AB"
                        WidthRequest="40"
                        HeightRequest="40"
                        Clicked="OnAttachFileClicked" />

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ -->
                <Button Grid.Column="2"
                        Text="âž¤"
                        BackgroundColor="#2E86AB"
                        TextColor="White"
                        WidthRequest="40"
                        HeightRequest="40"
                        Clicked="OnSendMessageClicked" />
            </Grid>
        </Border>
    </Grid>
</ContentPage>